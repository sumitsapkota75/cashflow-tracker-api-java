MONGODB_URI = mongodb+srv://eastloop123_db_user:bCiXnjuMdwX24Jgr@cluster0.04s6dce.mongodb.net/?appName=Cluster0


@RestController
@RequestMapping("/periods")
@RequiredArgsConstructor
@Slf4j
public class PeriodController {

    private final PeriodService periodService;
    private final PeriodMapper periodMapper;

    @PostMapping("/open")
    public ResponseEntity<PeriodResponse> openPeriod(
            @RequestBody PeriodOpenRequest request,
            @RequestHeader("X-USER-ID") String userId
    ) {
        log.info("Opening period for business {}", request.getBusinessId());
        Period period = periodService.openPeriod(request, userId);
        return ResponseEntity.ok(periodMapper.toResponse(period));
    }

    @PostMapping("/{id}/close")
    public ResponseEntity<PeriodResponse> closePeriod(
            @PathVariable String id,
            @RequestHeader("X-USER-ID") String userId
    ) {
        log.info("Closing period {}", id);
        Period period = periodService.closePeriod(id, userId);
        return ResponseEntity.ok(periodMapper.toResponse(period));
    }

    @GetMapping("/active/{businessId}")
    public ResponseEntity<PeriodResponse> getActivePeriod(
            @PathVariable String businessId
    ) {
        Period period = periodService.getActivePeriod(businessId);
        return ResponseEntity.ok(periodMapper.toResponse(period));
    }

    @GetMapping("/{id}")
    public ResponseEntity<PeriodResponse> getPeriodById(
            @PathVariable String id
    ) {
        Period period = periodService.getPeriodById(id);
        return ResponseEntity.ok(periodMapper.toResponse(period));
    }
}
